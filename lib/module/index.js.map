{"version":3,"names":["NativeEventEmitter","NativeModules","Platform","useEffect","useState","LINKING_ERROR","select","ios","default","RNOtpVerify","OtpVerify","Proxy","get","Error","eventEmitter","getOtp","OS","console","warn","startOtpListener","handler","then","addListener","useOtpVerify","numberOfDigits","message","setMessage","otp","setOtp","timeoutError","setTimeoutError","hash","setHash","handleMessage","response","otpDigits","RegExp","exec","getHash","removeListener","startListener","stopListener","requestHint","removeAllListeners"],"sources":["index.tsx"],"sourcesContent":["import {NativeEventEmitter, NativeModules, Platform} from 'react-native';\nimport {useEffect, useState} from 'react';\n\nconst LINKING_ERROR =\n  `The package 'react-native-otp-verify' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ios: \"- You have run 'pod install'\\n\", default: ''}) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst RNOtpVerify = NativeModules.OtpVerify\n  ? NativeModules.OtpVerify\n  : new Proxy(\n      {},\n      {\n        get() {\n          throw new Error(LINKING_ERROR);\n        },\n      },\n    );\n\nconst eventEmitter = new NativeEventEmitter(RNOtpVerify);\n\ninterface OtpVerify {\n  getOtp: () => Promise<boolean>;\n  getHash: () => Promise<string[]>;\n  requestHint: () => Promise<string>;\n  startOtpListener: (\n    handler: (value: string) => any,\n  ) => Promise<import('react-native').EmitterSubscription>;\n  addListener: (\n    handler: (value: string) => any,\n  ) => import('react-native').EmitterSubscription;\n  removeListener: () => void;\n}\n\nexport async function getOtp(): Promise<boolean> {\n  if (Platform.OS === 'ios') {\n    console.warn('Not Supported on iOS');\n    return false;\n  }\n  return RNOtpVerify.getOtp();\n}\n\nexport function startOtpListener(\n  handler: (value: string) => any,\n): Promise<import('react-native').EmitterSubscription> {\n  return getOtp().then(() => addListener(handler));\n}\n\nexport const useOtpVerify = ({numberOfDigits} = {numberOfDigits: 0}) => {\n  const [message, setMessage] = useState<string | null>(null);\n  const [otp, setOtp] = useState<string | null>(null);\n  const [timeoutError, setTimeoutError] = useState<boolean>(false);\n  const [hash, setHash] = useState<string[] | null>([]);\n\n  const handleMessage = (response: string) => {\n    if (response === 'Timeout Error.') {\n      setTimeoutError(true);\n    } else {\n      setMessage(response);\n      if (numberOfDigits && response) {\n        const otpDigits = new RegExp(`(\\\\d{${numberOfDigits}})`, 'g').exec(\n          response,\n        );\n        if (otpDigits && otpDigits[1]) setOtp(otpDigits[1]);\n      }\n    }\n  };\n  useEffect(() => {\n    if (Platform.OS === 'ios') {\n      console.warn('Not Supported on iOS');\n      return;\n    }\n    getHash().then(setHash);\n    startOtpListener(handleMessage);\n    return () => {\n      removeListener();\n    };\n  }, []);\n  const startListener = () => {\n    if (Platform.OS === 'ios') {\n      console.warn('Not Supported on iOS');\n      return;\n    }\n    setOtp('');\n    setMessage('');\n    startOtpListener(handleMessage);\n  };\n  const stopListener = () => {\n    if (Platform.OS === 'ios') {\n      console.warn('Not Supported on iOS');\n      return;\n    }\n    removeListener();\n  };\n  return {otp, message, hash, timeoutError, stopListener, startListener};\n};\n\nexport async function getHash(): Promise<string[]> {\n  if (Platform.OS === 'ios') {\n    console.warn('Not Supported on iOS');\n    return [];\n  }\n  return RNOtpVerify.getHash();\n}\nexport async function requestHint(): Promise<string> {\n  if (Platform.OS === 'ios') {\n    console.warn('Not Supported on iOS');\n    return '';\n  }\n  return RNOtpVerify.requestHint();\n}\n\nexport function addListener(\n  handler: (value: string) => any,\n): import('react-native').EmitterSubscription {\n  return eventEmitter.addListener('com.kailas.otpVerify:otpReceived', handler);\n}\n\nexport function removeListener(): void {\n  return eventEmitter.removeAllListeners('com.kailas.otpVerify:otpReceived');\n}\n\nconst OtpVerify: OtpVerify = {\n  getOtp,\n  getHash,\n  addListener,\n  removeListener,\n  startOtpListener,\n  requestHint,\n};\n\nexport default OtpVerify;\n"],"mappings":"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","ignoreList":[]}